<odoo>
  <data>
    <record id="view_rental_contract_form" model="ir.ui.view">
      <field name="name">rental.contract.form</field>
      <field name="model">rental.contract</field>
      <field name="arch" type="xml">
        <form string="Rental Contract">
          <header>

            <button name="next_draft_state" type="object" class="oe_highlight" invisible="state != 'draft' or draft_state == 'financial_info'" icon="fa-arrow-circle-o-right" string="Next" />
            <button name="prev_draft_state" type="object" class="oe_highlight" invisible="state != 'draft' or draft_state == 'customer_info'" icon="fa-arrow-circle-o-left" string="Back" />
            <button name="action_pay" type="object" invisible="state != 'draft' or draft_state != 'financial_info' or due_amount == 0" string="Pay" class="oe_highlight"/>
            <button name="action_open" type="object" invisible="state != 'draft' or draft_state != 'financial_info'" string="Open" class="oe_highlight" confirm="Are you sure you want to open this contract?"/>
            <button name="action_delivered_pending" type="object" invisible="state != 'opened'" string="Delivered Pending" class="oe_highlight"/>
            <button name="action_delivered_debit" type="object" invisible="state != 'delivered_pending'" string="Delivered Debit" class="oe_highlight"/>
            <button name="action_close" type="object" invisible="state != 'delivered_debit'" string="Close" class="oe_highlight"/>
            <button name="action_cancel" type="object" invisible="state != 'draft'" string="Cancel"/>

            <field name="draft_state" widget="statusbar" readonly="0" invisible="state != 'draft'" />
            <field name="state" widget="statusbar" statusbar_visible="opened,delivered_pending,delivered_debit,closed" invisible="state == 'draft'" />
          </header>
          <sheet>
            <!-- button box -->
            <div class="oe_button_box" name="button_box">
              <button class="oe_stat_button" name="view_related_payments" type="object" icon="fa-dollar" invisible="payment_count == 0">
                <div class="o_stat_info">
                  <span class="o_stat_value">
                    <field name="payment_count" />
                  </span>
                  <span class="o_stat_text">Payments</span>
                </div>
              </button>
            </div>

            <!-- title -->
            <div class="oe_title" invisible="state == 'draft'">
              <h1>
                <field name="name" />
              </h1>
            </div>
            <!-- customer_info -->
            <group invisible="state == 'draft' and draft_state != 'customer_info'" string="Customer Info">
              <group>
                <field name="company_id" options="{'no_create': True, 'no_open': True}" />
                <field name="partner_id" options="{'no_create': True}" context="{'form_view_ref': 'customer_info.view_partner_form_rental', 'search_by_mobile': True}" />
                <field name="partner_mobile" />
                <field name="partner_id_no" />
              </group>
            </group>
            <!-- vehicle_info -->
            <group invisible="state == 'draft' and draft_state != 'vehicle_info'" string="Vehicle Info">
              <group>
                <label for="vehicle_id" />
                <div class="o_row">
                  <field name="vehicle_id" required="draft_state != 'customer_info'" options="{'no_create': True}" />
                  <field name="vehicle_model_datail_id" invisible="1" />
                  <button name="view_vehicle_model_pricing" type="object" class="oe_highlight" icon="fa-external-link" string="View Model Pricing" invisible="not vehicle_model_datail_id" />
                </div>
                <field name="license_plate" />
                <field name="model_id" />
                <field name="category_id" />
                <field name="odometer" />
              </group>
            </group>
            <group invisible="state == 'draft' and draft_state != 'vehicle_info'" name="check_list" string="CheckList">
              <group>
                <field name="ac" required="draft_state != 'customer_info'" />
                <field name="radio_stereo" required="draft_state != 'customer_info'" />
                <field name="screen" required="draft_state != 'customer_info'" />
                <field name="spare_tire_tools" required="draft_state != 'customer_info'" />
                <field name="tires" required="draft_state != 'customer_info'" />
                <field name="spare_tires" required="draft_state != 'customer_info'" />
              </group>
              <group >
                <field name="speedometer" required="draft_state != 'customer_info'" />
                <field name="keys" required="draft_state != 'customer_info'" />
                <field name="care_seats" required="draft_state != 'customer_info'" />
                <field name="oil_change_km" required="draft_state != 'customer_info'" />
                <field name="fuel_type_code" required="draft_state != 'customer_info'" />
                <field name="keys_number" required="draft_state != 'customer_info'" />
              </group>
              <group >
                <field name="safety_triangle" required="draft_state != 'customer_info'" />
                <field name="fire_extinguisher" required="draft_state != 'customer_info'" />
                <field name="first_aid_kit" required="draft_state != 'customer_info'" />
                <field name="oil_type" required="draft_state != 'customer_info'" />
                <field name="oil_change_date" required="draft_state != 'customer_info'" />
                <field name="vehicle_status" required="draft_state != 'customer_info'" />
              </group>
            </group>
            <!-- contract_info -->
            <group invisible="state == 'draft' and draft_state != 'contract_info'" string="Contract Info">
              <group>
                <field name="vehicle_branch_id" />
                <field name="pickup_date" required="draft_state not in ['customer_info', 'vehicle_info']" />
                <field name="duration" required="draft_state not in ['customer_info', 'vehicle_info']" />
                <field name="rental_plan" required="draft_state not in ['customer_info', 'vehicle_info']" />
                <field name="authorization_type" required="draft_state not in ['customer_info', 'vehicle_info']" />
                <field name="authorization_country_id" options="{'no_create': True}" required="draft_state not in ['customer_info', 'vehicle_info'] and authorization_type == 'external'" invisible="authorization_type != 'external'" />
                <field name="need_extra_driver" required="draft_state not in ['customer_info', 'vehicle_info']" />
                <field name="extra_driver_id" required="draft_state not in ['customer_info', 'vehicle_info'] and need_extra_driver == 'true'" invisible="need_extra_driver != 'true'" options="{'no_create': True}" context="{'form_view_ref': 'customer_info.view_partner_form_rental', 'search_by_mobile': True}" />
              </group>
              <group invisible="state == 'draft' and draft_state != 'contract_info'">
                <field name="expected_return_date" />
              </group>
            </group>

            <!-- additional_suppl_service -->
            <group>
              <group invisible="state == 'draft' and draft_state != 'additional_suppl_service'" string="Additional Services">
                <field name="additional_services" options="{'no_open': True, 'no_create': True}" widget="many2many_checkboxes" nolabel="1" required="draft_state not in ['customer_info', 'vehicle_info', 'contract_info']" />
              </group>
              <group invisible="state == 'draft' and draft_state != 'additional_suppl_service'" string="Supplementary Services">
                <field name="supplementary_services" options="{'no_open': True, 'no_create': True}" widget="many2many_checkboxes" nolabel="1" required="draft_state not in ['customer_info', 'vehicle_info', 'contract_info']" />
              </group>
            </group>
            <!-- financial_info -->
            <group invisible="state == 'draft' and draft_state != 'financial_info'" string="Financial Info">
              <group>
                <field name="daily_rate" />
                <field name="daily_additional_services_rate" />
                <field name="daily_supplementary_services_rate" />
                <field name="daily_authorization_country_rate" />
                <field name="total_per_day" />
                <field name="one_time_services" />
                <field name="duration" readonly="1" />
              </group>
              <group >
                <field name="total_amount" />
                <field name="discount_percentage" />
                <field name="tax_percentage" />
                <field name="tax_amount" />
                <field name="due_amount" />
                <field name="paid_amount" />
              </group>
            </group>
          </sheet>
          <!-- Chatter -->
          <chatter />
        </form>
      </field>
    </record>

    <record id="view_rental_contract_tree" model="ir.ui.view">
      <field name="name">rental.contract.tree</field>
      <field name="model">rental.contract</field>
      <field name="arch" type="xml">
        <list string="Rental Contracts">
          <field name="name" />
          <field name="partner_id" />
          <field name="vehicle_id" />
          <field name="state" />
        </list>
      </field>
    </record>

  </data>
  <record id="action_rental_contract" model="ir.actions.act_window">
    <field name="name">Rental Contracts</field>
    <field name="res_model">rental.contract</field>
    <field name="view_mode">list,form</field>
    <field name="view_id" ref="view_rental_contract_tree" />
    <field name="help" type="html">
      <p class="oe_view_nocontent_create">
                Create your first rental contract
      </p>
    </field>
  </record>
  <menuitem id="menu_rental_contract" name="Contracts" parent="rental_customization.rental_main_menu" sequence="10" />
  <menuitem id="menu_individual_rental_contract" name="Individual Contracts" parent="menu_rental_contract" action="action_rental_contract" sequence="10" />
</odoo>
