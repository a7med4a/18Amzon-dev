<odoo>
  <data>


    <record id="view_rental_contract_form" model="ir.ui.view">
      <field name="name">rental.contract.form</field>
      <field name="model">rental.contract</field>
      <field name="arch" type="xml">
        <form string="Rental Contract">
          <header>
            <!-- Draft Buttons -->
            <button name="next_draft_state" type="object" class="oe_highlight" invisible="state != 'draft' or draft_state == 'financial_info'" icon="fa-arrow-circle-o-right" string="Next" />
            <button name="prev_draft_state" type="object" class="oe_highlight" invisible="state != 'draft' or draft_state == 'customer_info'" icon="fa-arrow-circle-o-left" string="Back" />
            <button name="action_pay" type="object" invisible="state != 'draft' or draft_state != 'financial_info' or due_amount == 0" string="Pay" class="oe_highlight" />
            <button name="action_open" type="object" invisible="state != 'draft' or draft_state != 'financial_info'" string="Open" class="oe_highlight" confirm="Are you sure you want to open this contract?" />
            <!-- Open Buttons -->
            <button name="%(rental_contract.rental_contract_fines_wiz_action)d" type="action" invisible="state != 'opened'" string="Add Fines" class="oe_highlight" />
            <button name="%(rental_contract.rental_contract_discount_wiz_action)d" type="action" invisible="state != 'opened'" string="Add Discount Voucher" class="oe_highlight" />
            <button name="action_delivered_pending" type="object" invisible="state != 'opened'" string="Delivered Pending" class="oe_highlight" />
            <!-- Delivered Pending Buttons -->
            <button name="action_delivered_debit" type="object" invisible="state != 'delivered_pending'" string="Delivered Debit" class="oe_highlight" />
            <!-- Delivered Debit Buttons -->
            <button name="action_close" type="object" invisible="state != 'delivered_debit'" string="Close" class="oe_highlight" />
            <!-- Cancel Button -->
            <button name="action_cancel" type="object" invisible="state != 'draft'" string="Cancel" />
            <!-- State Fields -->
            <field name="draft_state" widget="statusbar" readonly="0" invisible="state != 'draft'" />
            <field name="state" widget="statusbar" statusbar_visible="opened,delivered_pending,delivered_debit,closed" invisible="state == 'draft'" />
          </header>
          <sheet>
            <!-- button box -->
            <div class="oe_button_box" name="button_box">
              <button class="oe_stat_button" name="view_related_payments" type="object" icon="fa-dollar" invisible="payment_count == 0">
                <div class="o_stat_info">
                  <span class="o_stat_value">
                    <field name="payment_count" />
                  </span>
                  <span class="o_stat_text">Payments</span>
                </div>
              </button>

              <button class="oe_stat_button" name="%(rental_contract.rental_contract_fines_discount_line_action)d" type="action" icon="fa-bars" invisible="fines_discount_count == 0">
                <div class="o_stat_info">
                  <span class="o_stat_value">
                    <field name="fines_discount_count" />
                  </span>
                  <span class="o_stat_text">Fines - Discount</span>
                </div>
              </button>

              <button class="oe_stat_button" name="view_related_invoices" type="object" icon="fa-edit" invisible="invoice_count == 0">
                <div class="o_stat_info">
                  <span class="o_stat_value">
                    <field name="invoice_count" />
                  </span>
                  <span class="o_stat_text">Invoices</span>
                </div>
              </button>

              <button class="oe_stat_button" name="view_related_credit_note" type="object" icon="fa-edit" invisible="credit_note_count == 0">
                <div class="o_stat_info">
                  <span class="o_stat_value">
                    <field name="credit_note_count" />
                  </span>
                  <span class="o_stat_text">Credit Notes</span>
                </div>
              </button>

            </div>

            <!-- title -->
            <div class="oe_title" invisible="state == 'draft'">
              <h1>
                <field name="name" />
              </h1>
            </div>
            <!-- customer_info -->
            <group invisible="state == 'draft' and draft_state != 'customer_info'" string="Customer Info">
              <group>
                <field name="company_id" options="{'no_create': True, 'no_open': True}" readonly="state != 'draft'" />
                <field name="partner_id" options="{'no_create': True}" context="{'form_view_ref': 'customer_info.view_partner_form_rental', 'search_by_mobile': True}" readonly="state != 'draft'" />
                <field name="partner_mobile" />
                <field name="partner_id_no" />
              </group>
            </group>
            <!-- vehicle_info -->
            <group invisible="state == 'draft' and draft_state != 'vehicle_info'" string="Vehicle Info">
              <group>
                <label for="vehicle_id" />
                <div class="o_row">
                  <field name="vehicle_id" required="draft_state != 'customer_info'" options="{'no_create': True}" readonly="state != 'draft'" />
                  <field name="vehicle_model_datail_id" invisible="1" />
                  <button name="view_vehicle_model_pricing" type="object" class="oe_highlight" icon="fa-external-link" string="View Model Pricing" invisible="not vehicle_model_datail_id" />
                </div>
                <field name="license_plate" />
                <field name="model_id" />
                <field name="category_id" />
                <field name="odometer" readonly="state != 'draft'" />
              </group>
            </group>
            <group invisible="state == 'draft' and draft_state != 'vehicle_info'" name="check_list" string="CheckList">
              <group>
                <field name="ac" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="radio_stereo" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="screen" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="spare_tire_tools" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="tires" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="spare_tires" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
              </group>
              <group >
                <field name="speedometer" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="keys" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="care_seats" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="oil_change_km" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="fuel_type_code" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="keys_number" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
              </group>
              <group >
                <field name="safety_triangle" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="fire_extinguisher" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="first_aid_kit" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="oil_type" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="oil_change_date" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
                <field name="vehicle_status" required="draft_state != 'customer_info'" readonly="state != 'draft'" />
              </group>
            </group>
            <!-- contract_info -->
            <group invisible="state == 'draft' and draft_state != 'contract_info'" string="Contract Info">
              <group>
                <field name="vehicle_branch_id" />
                <field name="pickup_date" required="draft_state not in ['customer_info', 'vehicle_info']" readonly="state != 'draft'" />
                <field name="duration" required="draft_state not in ['customer_info', 'vehicle_info']" readonly="state != 'draft'" />
                <field name="rental_plan" required="draft_state not in ['customer_info', 'vehicle_info']" readonly="state != 'draft'" />
                <field name="authorization_type" required="draft_state not in ['customer_info', 'vehicle_info']" readonly="state != 'draft'" />
                <field name="authorization_country_id" options="{'no_create': True}" required="draft_state not in ['customer_info', 'vehicle_info'] and authorization_type == 'external'" invisible="authorization_type != 'external'" readonly="state != 'draft'" />
                <field name="need_extra_driver" required="draft_state not in ['customer_info', 'vehicle_info']" readonly="state != 'draft'" />
                <field name="extra_driver_id" required="draft_state not in ['customer_info', 'vehicle_info'] and need_extra_driver == 'true'" invisible="need_extra_driver != 'true'" options="{'no_create': True}" context="{'form_view_ref': 'customer_info.view_partner_form_rental', 'search_by_mobile': True}" readonly="state != 'draft'" />
              </group>
              <group invisible="state == 'draft' and draft_state != 'contract_info'">
                <field name="expected_return_date" />
              </group>
            </group>

            <!-- additional_suppl_service -->
            <group>
              <group invisible="state == 'draft' and draft_state != 'additional_suppl_service'" string="Additional Services">
                <field name="additional_services" options="{'no_open': True, 'no_create': True}" widget="many2many_checkboxes" nolabel="1" required="draft_state not in ['customer_info', 'vehicle_info', 'contract_info']" readonly="state != 'draft'" />
              </group>
              <group invisible="state == 'draft' and draft_state != 'additional_suppl_service'" string="Supplementary Services">
                <field name="supplementary_services" options="{'no_open': True, 'no_create': True}" widget="many2many_checkboxes" nolabel="1" required="draft_state not in ['customer_info', 'vehicle_info', 'contract_info']" readonly="state != 'draft'" />
              </group>
            </group>
            <!-- financial_info -->
            <group invisible="state == 'draft' and draft_state != 'financial_info'" string="Financial Info">
              <group>
                <field name="daily_rate" />
                <field name="daily_additional_services_rate" />
                <field name="daily_supplementary_services_rate" />
                <field name="daily_authorization_country_rate" />
                <field name="total_per_day" />
                <field name="one_time_services" />
                <field name="duration" readonly="1" />
              </group>
              <group >
                <field name="total_amount" />
                <field name="discount_percentage"  readonly="state != 'draft'"/>
                <field name="tax_percentage"  readonly="state != 'draft'"/>
                <field name="tax_amount" />
                <field name="due_amount" />
                <field name="paid_amount" />
              </group>
            </group>

            <!-- Current Due Amount -->

            <group invisible="state == 'draft'" string="Current Due Amount">
              <group>
                <label for="display_actual_days" string="Actual" invisible="state != 'opened'" style="font-weight:bold;" />
                <div class="o_row o_row_readonly" invisible="state != 'opened'">
                  <label for="display_actual_days" string="Days" />
                  <field name="display_actual_days" />
                  <label for="display_actual_hours" string="Hours" />
                  <field name="display_actual_hours" />
                </div>
                <label for="display_current_days" string="Current" invisible="state != 'opened'" style="font-weight:bold;" />
                <div class="o_row o_row_readonly" invisible="state != 'opened'">
                  <label for="display_current_days" string="Days" />
                  <field name="display_current_days" />
                  <label for="display_current_hours" string="Hours" />
                  <field name="display_current_hours" />
                </div>

                <label for="actual_days" string="Actual" invisible="state in ['draft', 'opened']" style="font-weight:bold;" />
                <div class="o_row o_row_readonly" invisible="state in ['draft', 'opened']">
                  <label for="actual_days" string="Days" />
                  <field name="actual_days" readonly="1" />
                  <label for="actual_hours" string="Hours" />
                  <field name="actual_hours" readonly="1" />
                </div>
                <label for="current_days" string="Current" invisible="state  in ['draft', 'opened']" style="font-weight:bold;" />
                <div class="o_row o_row_readonly" invisible="state in ['draft', 'opened']">
                  <label for="current_days" string="Days" />
                  <field name="current_days" readonly="1" />
                  <label for="current_hours" string="Hours" />
                  <field name="current_hours" readonly="1" />
                </div>

                <field name="assumed_amount" />
                <field name="paid_amount" />
                <field name="discount_voucher_amount" />
              </group>

              <group>
                <field name="display_current_amount" invisible="state != 'opened'" />
                <field name="current_amount" invisible="state in ['draft', 'opened']" />
                <field name="current_fines_amount" />
                <field name="current_accident_damage_amount" readonly="state not in ['draft', 'opened']"/>
                <label for="current_km_extra_amount" />
                <div class="o_row">
                  <field name="current_km_extra_amount" readonly="1" />
                  <button name="view_calculate_km" type="object" class="oe_highlight" icon="fa-external-link" string="Calculate KM" />
                </div>
                <div class="row">
                  <div class="col-7">
                    <h3 style="padding-bottom:7px; font-weight:bold; color:red;">Current Due Amount :</h3>
                  </div>
                  <div class="col-5">
                    <h3>
                      <field name="current_due_amount" style="font-weight:bold; color:red;" readonly="1" />
                    </h3>

                  </div>
                </div>
              </group>
            </group>
          </sheet>
          <!-- Chatter -->
          <chatter />
        </form>
      </field>
    </record>

    <record id="view_rental_contract_calculate_km_form" model="ir.ui.view">
      <field name="name">rental.contract.calculate.km.form</field>
      <field name="model">rental.contract</field>
      <field name="priority">10000</field>
      <field name="arch" type="xml">
        <form string="Calculate KM">
          <sheet>
            <group>
              <group>

                <label for="odometer_km_in" string="KM In" />
                <div>
                  <field name="odometer_km_in" class="oe_inline" readonly="state != 'opened'"/>
                  <span> KM </span>
                </div>

                <label for="odometer" string="KM Out" />
                <div>
                  <field name="odometer" class="oe_inline" readonly="1" />
                  <span> KM </span>
                </div>

                <label for="free_km_per_day" string="Free KM Per Day" />
                <div>
                  <field name="free_km_per_day" class="oe_inline" />
                  <span> KM </span>
                </div>

                <label for="display_current_days" string="Current Duration" />
                <div>
                  <field name="display_current_days" class="oe_inline" />
                  <span> Days </span>
                </div>

                <label for="total_free_km" string="Total Free KM" />
                <div>
                  <field name="total_free_km" class="oe_inline" />
                  <span> KM </span>
                </div>

                <label for="consumed_km" string="Consumed KM" />
                <div>
                  <field name="consumed_km" class="oe_inline" />
                  <span> KM </span>
                </div>

                <label for="total_extra_km" string="Total Extra KM" />
                <div>
                  <field name="total_extra_km" class="oe_inline" />
                  <span> KM </span>
                </div>

                <field name="display_current_km_extra_amount" />

              </group>
            </group>
          </sheet>
          <footer>
            <button name="set_current_km_extra_amount" string="Calculate" type="object" class="btn-primary" invisible="state != 'opened'"/>
            <button string="Cancel" class="btn-secondary" special="cancel" />
          </footer>
        </form>
      </field>
    </record>

    <record id="view_rental_contract_tree" model="ir.ui.view">
      <field name="name">rental.contract.tree</field>
      <field name="model">rental.contract</field>
      <field name="arch" type="xml">
        <list string="Rental Contracts">
          <field name="name" />
          <field name="partner_id" />
          <field name="vehicle_id" />
          <field name="state" />
        </list>
      </field>
    </record>

  </data>
  <record id="action_rental_contract" model="ir.actions.act_window">
    <field name="name">Rental Contracts</field>
    <field name="res_model">rental.contract</field>
    <field name="view_mode">list,form</field>
    <field name="view_id" ref="view_rental_contract_tree" />
    <field name="help" type="html">
      <p class="oe_view_nocontent_create">
                Create your first rental contract
      </p>
    </field>
  </record>
  <menuitem id="menu_rental_contract" name="Contracts" parent="rental_customization.rental_main_menu" sequence="10" />
  <menuitem id="menu_individual_rental_contract" name="Individual Contracts" parent="menu_rental_contract" action="action_rental_contract" sequence="10" />
</odoo>
