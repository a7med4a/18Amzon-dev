# دليل موديول التكامل مع هيئة النقل السعودية (STA Integration Module)

**الإصدار:** 18.0.1.0.0  
**المؤلف:** Ahmed Amen  
**التاريخ:** يونيو 2025  
**النظام:** Odoo 18 Enterprise  

---

## جدول المحتويات

1. [مقدمة](#مقدمة)
2. [متطلبات النظام](#متطلبات-النظام)
3. [التثبيت والإعداد](#التثبيت-والإعداد)
4. [الإعدادات الأولية](#الإعدادات-الأولية)
5. [دليل المستخدم](#دليل-المستخدم)
6. [الوثائق التقنية](#الوثائق-التقنية)
7. [استكشاف الأخطاء وإصلاحها](#استكشاف-الأخطاء-وإصلاحها)
8. [الأسئلة الشائعة](#الأسئلة-الشائعة)
9. [الدعم والصيانة](#الدعم-والصيانة)

---

## مقدمة

موديول التكامل مع هيئة النقل السعودية (STA Integration Module) هو حل متكامل مصمم خصيصاً لربط نظام إدارة تأجير السيارات في أودو مع أنظمة هيئة النقل السعودية. يوفر هذا الموديول تكاملاً سلساً وآمناً مع واجهات برمجة التطبيقات (APIs) الخاصة بهيئة النقل، مما يمكن شركات تأجير السيارات من الامتثال للمتطلبات التنظيمية السعودية وتبسيط عمليات إدارة العقود.

### الهدف من الموديول

تم تطوير هذا الموديول لتلبية الحاجة المتزايدة لشركات تأجير السيارات في المملكة العربية السعودية للتكامل مع أنظمة هيئة النقل الرسمية. يهدف الموديول إلى:

- **تبسيط عمليات التسجيل**: أتمتة عملية تسجيل عقود الإيجار مع هيئة النقل السعودية
- **ضمان الامتثال**: التأكد من أن جميع العقود تتوافق مع المتطلبات التنظيمية المحلية
- **تحسين الكفاءة**: تقليل الوقت والجهد المطلوب لإدارة العقود والتقارير
- **تعزيز الدقة**: تقليل الأخطاء البشرية من خلال الأتمتة والتحقق الآلي
- **توفير الشفافية**: إتاحة تتبع حالة العقود في الوقت الفعلي

### الميزات الرئيسية

يوفر موديول التكامل مع هيئة النقل السعودية مجموعة شاملة من الميزات المتقدمة:

**إدارة العقود المتقدمة**: يتيح الموديول إنشاء وإدارة عقود الإيجار بطريقة متكاملة مع أنظمة هيئة النقل. يمكن للمستخدمين إنشاء عقود جديدة، تحديث العقود الموجودة، وتتبع حالة كل عقد عبر دورة حياته الكاملة من الإنشاء إلى الإغلاق.

**التحقق الآمن بـ OTP**: يدعم الموديول نظام التحقق بالرمز المؤقت (OTP) المطلوب من هيئة النقل السعودية، مما يضمن أمان العمليات والامتثال للمعايير الأمنية المطلوبة.

**إدارة الفروع المتزامنة**: يوفر الموديول تزامناً تلقائياً لبيانات الفروع بين نظام أودو وأنظمة هيئة النقل، مما يضمن تحديث المعلومات باستمرار ودقة البيانات.

**سياسات الإيجار المرنة**: يدعم الموديول تزامن سياسات الإيجار المختلفة من هيئة النقل، مما يتيح للشركات تطبيق السياسات المناسبة لكل نوع من أنواع العقود.

**تتبع حالة العقود في الوقت الفعلي**: يوفر الموديول واجهة مستخدم متقدمة لتتبع حالة العقود، مع إشعارات فورية عند تغيير الحالة أو حدوث أي مشاكل.

**إدارة العمليات المتقدمة**: يدعم الموديول جميع العمليات المطلوبة لإدارة العقود، بما في ذلك الإلغاء، التعليق، والإغلاق، مع واجهات مستخدم بديهية لكل عملية.




## متطلبات النظام

### متطلبات البرمجيات الأساسية

لضمان التشغيل السليم لموديول التكامل مع هيئة النقل السعودية، يجب توفر المتطلبات التالية في البيئة التشغيلية:

**نظام أودو**: يتطلب الموديول نظام Odoo 18 Enterprise أو إصدار أحدث. تم تصميم الموديول خصيصاً للعمل مع الإصدار 18 من أودو، ويستفيد من الميزات المتقدمة المتوفرة في الإصدار التجاري (Enterprise). لا يدعم الموديول الإصدارات الأقدم من أودو بسبب اعتماده على واجهات برمجة التطبيقات والميزات الحديثة.

**Python**: يتطلب الموديول Python 3.8 أو إصدار أحدث. تم تطوير الموديول باستخدام ميزات Python الحديثة، ويعتمد على مكتبات خارجية تتطلب إصدارات حديثة من Python لضمان الأداء الأمثل والأمان.

**مكتبات Python المطلوبة**: يعتمد الموديول على عدة مكتبات Python خارجية، أهمها:
- `requests`: لإجراء استدعاءات HTTP إلى واجهات برمجة التطبيقات الخاصة بهيئة النقل
- `json`: لمعالجة البيانات بصيغة JSON
- `datetime`: لإدارة التواريخ والأوقات
- `logging`: لتسجيل العمليات والأخطاء

### الموديولات المطلوبة في أودو

يعتمد موديول التكامل مع هيئة النقل السعودية على عدة موديولات أساسية في نظام أودو. هذه الموديولات يجب أن تكون مثبتة ومفعلة قبل تثبيت موديول التكامل:

**rental_contract**: هذا الموديول الأساسي لإدارة عقود الإيجار في النظام. يوفر الهيكل الأساسي لإنشاء وإدارة عقود تأجير السيارات، ويعتبر حجر الأساس الذي يبني عليه موديول التكامل مع هيئة النقل.

**branches_management**: موديول إدارة الفروع الذي يوفر إمكانية إدارة فروع الشركة المختلفة. يستخدم موديول التكامل هذا الموديول لربط فروع الشركة في أودو مع فروع هيئة النقل المسجلة.

**customer_info**: موديول إدارة معلومات العملاء الذي يوفر حقول إضافية لتخزين المعلومات المطلوبة لهيئة النقل، مثل رقم الهوية، رقم جواز السفر، وتاريخ الميلاد الهجري.

**vehicle_info**: موديول إدارة معلومات المركبات الذي يوفر تفاصيل شاملة عن المركبات المتاحة للإيجار، بما في ذلك أرقام اللوحات، نوع الوقود، وحالة المركبة.

**fleet_status**: موديول إدارة حالة الأسطول الذي يتيح تتبع حالة المركبات المختلفة وتوفرها للإيجار.

### متطلبات الشبكة والأمان

**الاتصال بالإنترنت**: يتطلب الموديول اتصالاً مستقراً وآمناً بالإنترنت للتواصل مع خوادم هيئة النقل السعودية. يجب أن يكون الاتصال قادراً على التعامل مع بروتوكول HTTPS وشهادات SSL/TLS.

**إعدادات الجدار الناري**: يجب السماح للخادم بالوصول إلى عناوين IP الخاصة بهيئة النقل السعودية على المنافذ المطلوبة (عادة 443 للـ HTTPS).

**شهادات الأمان**: يجب التأكد من أن النظام يدعم أحدث بروتوكولات الأمان وشهادات SSL/TLS المطلوبة للتواصل مع أنظمة هيئة النقل.

### متطلبات الأداء

**ذاكرة الوصول العشوائي**: يُنصح بتوفر ذاكرة وصول عشوائي لا تقل عن 8 جيجابايت لضمان الأداء السليم، خاصة عند التعامل مع عدد كبير من العقود المتزامنة.

**مساحة التخزين**: يتطلب الموديول مساحة تخزين إضافية لحفظ سجلات التزامن والاستجابات من هيئة النقل. يُنصح بتوفر مساحة لا تقل عن 1 جيجابايت إضافية.

**معالج البيانات**: يُنصح باستخدام معالج متعدد النوى لضمان الأداء الأمثل عند إجراء عمليات التزامن المتعددة.

---

## التثبيت والإعداد

### خطوات التثبيت الأساسية

عملية تثبيت موديول التكامل مع هيئة النقل السعودية تتطلب اتباع خطوات محددة لضمان التثبيت السليم والتشغيل الآمن:

**الخطوة الأولى - التحضير**: قبل البدء في عملية التثبيت، يجب التأكد من أن جميع المتطلبات الأساسية متوفرة ومثبتة بشكل صحيح. هذا يشمل التحقق من إصدار أودو، توفر الموديولات المطلوبة، والتأكد من استقرار الاتصال بالإنترنت.

**الخطوة الثانية - نسخ الملفات**: يجب نسخ مجلد الموديول الكامل إلى مجلد الموديولات المخصصة في تثبيت أودو. عادة ما يكون هذا المجلد في المسار `/opt/odoo/custom-addons/` أو المسار المحدد في إعدادات أودو. يجب التأكد من أن جميع الملفات والمجلدات الفرعية تم نسخها بشكل صحيح.

**الخطوة الثالثة - إعادة تشغيل الخدمة**: بعد نسخ الملفات، يجب إعادة تشغيل خدمة أودو لتحديث قائمة الموديولات المتاحة. يمكن القيام بذلك من خلال واجهة إدارة النظام أو باستخدام أوامر النظام المناسبة.

**الخطوة الرابعة - تحديث قائمة الموديولات**: من واجهة إدارة أودو، يجب الانتقال إلى قسم التطبيقات (Apps) والنقر على "تحديث قائمة التطبيقات" لضمان ظهور الموديول الجديد في القائمة.

**الخطوة الخامسة - تثبيت الموديول**: بعد ظهور موديول "STA Integration" في قائمة التطبيقات، يمكن النقر على زر "تثبيت" لبدء عملية التثبيت. سيقوم أودو تلقائياً بتثبيت جميع التبعيات المطلوبة.

### التحقق من التثبيت

بعد اكتمال عملية التثبيت، يجب التحقق من أن الموديول تم تثبيته بشكل صحيح:

**فحص القوائم**: يجب أن يظهر قسم جديد بعنوان "STA Integration" في القائمة الرئيسية لأودو. هذا القسم يحتوي على جميع الوظائف المتعلقة بالتكامل مع هيئة النقل.

**فحص الإعدادات**: في قسم الإعدادات العامة، يجب أن يظهر قسم جديد بعنوان "Saudi Transport Authority Integration" مع جميع الحقول المطلوبة للإعداد.

**فحص النماذج**: يجب التأكد من أن جميع النماذج الجديدة (STA Contracts، STA Branches، STA Rent Policies) متاحة ويمكن الوصول إليها.

### إعداد قاعدة البيانات

بعد التثبيت الناجح، سيقوم أودو تلقائياً بإنشاء الجداول والحقول المطلوبة في قاعدة البيانات. هذا يشمل:

**جداول البيانات الأساسية**: سيتم إنشاء جداول جديدة لتخزين معلومات عقود هيئة النقل، الفروع، وسياسات الإيجار.

**العلاقات بين الجداول**: سيتم إنشاء العلاقات المطلوبة بين الجداول الجديدة والجداول الموجودة في النظام.

**البيانات الأولية**: سيتم تحميل بعض البيانات الأولية مثل الفروع النموذجية وسياسات الإيجار الافتراضية.

### استكشاف مشاكل التثبيت

في حالة مواجهة مشاكل أثناء التثبيت، يمكن اتباع الخطوات التالية:

**فحص سجلات النظام**: يجب فحص سجلات أودو للبحث عن رسائل الخطأ التي قد تشير إلى سبب المشكلة.

**التحقق من الصلاحيات**: يجب التأكد من أن المستخدم الذي يقوم بالتثبيت لديه الصلاحيات المطلوبة لتعديل قاعدة البيانات وملفات النظام.

**فحص التبعيات**: يجب التأكد من أن جميع الموديولات المطلوبة مثبتة ومفعلة بشكل صحيح.

**إعادة المحاولة**: في بعض الحالات، قد تحل إعادة تشغيل النظام وإعادة محاولة التثبيت المشكلة.


---

## الإعدادات الأولية

### الحصول على بيانات الاعتماد من هيئة النقل

قبل البدء في استخدام موديول التكامل، يجب الحصول على بيانات الاعتماد المطلوبة من هيئة النقل السعودية. هذه العملية تتطلب التواصل المباشر مع هيئة النقل واتباع إجراءاتهم الرسمية:

**تقديم طلب التكامل**: يجب تقديم طلب رسمي لهيئة النقل السعودية للحصول على إذن التكامل مع أنظمتهم. هذا الطلب يجب أن يتضمن معلومات مفصلة عن الشركة، نوع الخدمات المقدمة، والغرض من التكامل.

**مراجعة المتطلبات التقنية**: ستقوم هيئة النقل بمراجعة الطلب والتأكد من أن النظام المقترح يلبي متطلباتهم التقنية والأمنية. قد تتطلب هذه العملية تقديم وثائق تقنية إضافية أو إجراء اختبارات أمنية.

**الحصول على بيانات الاعتماد**: بعد الموافقة على الطلب، ستقوم هيئة النقل بتوفير بيانات الاعتماد المطلوبة، والتي تشمل:
- **App ID**: معرف التطبيق الفريد المخصص لشركتك
- **App Key**: مفتاح التطبيق السري المستخدم للمصادقة
- **Authorization Token**: رمز التفويض المشفر للوصول إلى واجهات برمجة التطبيقات

### إعداد معاملات الاتصال

بعد الحصول على بيانات الاعتماد، يجب إدخالها في نظام أودو من خلال الخطوات التالية:

**الوصول إلى الإعدادات**: من القائمة الرئيسية في أودو، انتقل إلى "الإعدادات" ثم ابحث عن قسم "Saudi Transport Authority Integration".

**إدخال بيانات الاعتماد**: أدخل البيانات التي حصلت عليها من هيئة النقل في الحقول المناسبة:
- في حقل "STA App ID"، أدخل معرف التطبيق
- في حقل "STA App Key"، أدخل مفتاح التطبيق
- في حقل "STA Authorization Token"، أدخل رمز التفويض كاملاً

**تحديد بيئة التشغيل**: حدد ما إذا كنت تستخدم البيئة التجريبية (Staging) أم بيئة الإنتاج (Production). للاختبارات الأولية، يُنصح باستخدام البيئة التجريبية.

**حفظ الإعدادات**: بعد إدخال جميع البيانات، انقر على "حفظ" لتطبيق الإعدادات.

### اختبار الاتصال

بعد إعداد بيانات الاعتماد، يجب اختبار الاتصال مع أنظمة هيئة النقل للتأكد من صحة الإعدادات:

**تشغيل اختبار الاتصال**: في صفحة الإعدادات، انقر على زر "Test Connection" لبدء اختبار الاتصال. سيقوم النظام بإرسال طلب تجريبي إلى خوادم هيئة النقل.

**تفسير النتائج**: إذا كان الاتصال ناجحاً، ستظهر رسالة تأكيد خضراء. إذا فشل الاتصال، ستظهر رسالة خطأ تحتوي على تفاصيل المشكلة.

**حل مشاكل الاتصال**: في حالة فشل الاتصال، تحقق من:
- صحة بيانات الاعتماد المدخلة
- استقرار الاتصال بالإنترنت
- إعدادات الجدار الناري والبروكسي

### تزامن البيانات الأولية

بعد التأكد من نجاح الاتصال، يجب تزامن البيانات الأولية من هيئة النقل:

**تزامن الفروع**: انتقل إلى قسم "STA Integration" > "Configuration" > "Branches" وانقر على "Sync All Branches" لتحميل قائمة الفروع المعتمدة من هيئة النقل.

**تزامن سياسات الإيجار**: انتقل إلى "Rent Policies" وانقر على "Sync All Policies" لتحميل سياسات الإيجار المتاحة.

**مراجعة البيانات المتزامنة**: تأكد من أن البيانات تم تحميلها بشكل صحيح ومراجعة أي بيانات قد تحتاج إلى تعديل أو ربط مع البيانات الموجودة في النظام.

### ربط البيانات المحلية

بعد تزامن البيانات من هيئة النقل، يجب ربطها مع البيانات الموجودة في نظام أودو:

**ربط الفروع**: في قائمة فروع هيئة النقل، حدد كل فرع واربطه مع الفرع المقابل في نظام أودو من خلال حقل "Odoo Branch".

**التحقق من معلومات العملاء**: تأكد من أن معلومات العملاء في النظام تحتوي على جميع البيانات المطلوبة لهيئة النقل، مثل رقم الهوية وتاريخ الميلاد الهجري.

**التحقق من معلومات المركبات**: تأكد من أن معلومات المركبات تحتوي على جميع التفاصيل المطلوبة، مثل أرقام اللوحات ونوع الوقود.

---

## دليل المستخدم

### إنشاء عقد جديد مع هيئة النقل

عملية إنشاء عقد جديد مع هيئة النقل تتم من خلال عدة خطوات متسلسلة تضمن الامتثال لجميع المتطلبات:

**البدء من عقد الإيجار**: ابدأ بإنشاء عقد إيجار عادي في نظام أودو من خلال قسم "Rental Contracts". تأكد من إدخال جميع المعلومات المطلوبة بدقة، بما في ذلك معلومات العميل، المركبة، وتفاصيل الإيجار.

**إنشاء عقد هيئة النقل**: من صفحة عقد الإيجار، انقر على زر "Create STA Contract" لإنشاء عقد مرتبط مع هيئة النقل. سيتم فتح نموذج جديد لإدخال المعلومات الإضافية المطلوبة.

**إدخال المعلومات المطلوبة**: في نموذج عقد هيئة النقل، أدخل المعلومات التالية:
- **Working Branch**: الفرع الذي سيتم معالجة العقد فيه
- **Receive Branch**: الفرع الذي سيتم استلام المركبة منه
- **Return Branch**: الفرع الذي سيتم إرجاع المركبة إليه
- **Rent Policy**: سياسة الإيجار المطبقة على هذا العقد
- **Operator ID**: معرف الموظف المسؤول عن العقد

**إرسال العقد إلى هيئة النقل**: بعد إدخال جميع المعلومات، انقر على زر "Create in STA" لإرسال العقد إلى أنظمة هيئة النقل. سيقوم النظام بإرسال البيانات والحصول على رقم عقد من هيئة النقل.

### إدارة عمليات التحقق

بعد إنشاء العقد في أنظمة هيئة النقل، تأتي مرحلة التحقق والمصادقة:

**إرسال رمز التحقق (OTP)**: انقر على زر "Send OTP" لطلب إرسال رمز التحقق إلى العميل. سيتم إرسال الرمز عبر الوسائل المحددة من قبل هيئة النقل.

**إدخال رمز التحقق**: بعد حصول العميل على رمز التحقق، يجب إدخاله في النظام لتأكيد صحة العقد.

**حفظ العقد النهائي**: بعد التحقق الناجح، انقر على زر "Save Contract" لحفظ جميع تفاصيل العقد في أنظمة هيئة النقل. هذه الخطوة تجعل العقد رسمياً ونافذاً.

### إدارة دورة حياة العقد

خلال فترة سريان العقد، قد تحتاج إلى إجراء عمليات مختلفة:

**تعليق العقد**: في حالة الحاجة إلى تعليق العقد مؤقتاً (مثل إرجاع مبكر أو مشاكل في المركبة)، انقر على زر "Suspend". سيتم فتح نموذج مفصل لإدخال:
- سبب التعليق
- حالة المركبة عند الإرجاع
- قراءة العداد
- تفاصيل الدفع الإضافية

**إغلاق العقد**: عند انتهاء فترة الإيجار، انقر على زر "Close" لإغلاق العقد نهائياً. يتطلب هذا إدخال:
- تاريخ الإنهاء الفعلي
- حالة المركبة النهائية
- أي تكاليف إضافية
- طريقة الدفع

**إلغاء العقد**: في حالات استثنائية، يمكن إلغاء العقد من خلال زر "Cancel" مع إدخال سبب الإلغاء.

### مراقبة حالة العقود

يوفر النظام أدوات متقدمة لمراقبة حالة العقود:

**لوحة المعلومات**: تعرض لوحة المعلومات الرئيسية إحصائيات شاملة عن العقود، بما في ذلك عدد العقود النشطة، المعلقة، والمغلقة.

**تقارير مفصلة**: يمكن إنشاء تقارير مفصلة عن حالة العقود، مع إمكانية التصفية حسب التاريخ، الفرع، أو حالة العقد.

**الإشعارات التلقائية**: يرسل النظام إشعارات تلقائية عند تغيير حالة العقود أو حدوث أي مشاكل في التزامن.

### إدارة الفروع وسياسات الإيجار

**تحديث بيانات الفروع**: يمكن تحديث بيانات الفروع دورياً من خلال زر "Sync All Branches" في قسم إدارة الفروع.

**إدارة سياسات الإيجار**: يمكن مراجعة وتحديث سياسات الإيجار من خلال قسم "Rent Policies"، مع إمكانية تزامن السياسات الجديدة من هيئة النقل.

**ربط البيانات المحلية**: يمكن ربط فروع هيئة النقل مع فروع الشركة في أودو لضمان التكامل السليم.


---

## الوثائق التقنية

### هيكل الموديول

موديول التكامل مع هيئة النقل السعودية مصمم وفقاً لأفضل الممارسات في تطوير موديولات أودو، مع تنظيم واضح للملفات والمجلدات:

**المجلد الجذر**: يحتوي على الملفات الأساسية للموديول:
- `__init__.py`: ملف التهيئة الرئيسي الذي يستورد جميع المكونات
- `__manifest__.py`: ملف البيان الذي يحدد معلومات الموديول وتبعياته

**مجلد Models**: يحتوي على جميع نماذج البيانات:
- `sta_config_settings.py`: نموذج إعدادات التكامل مع هيئة النقل
- `sta_contract.py`: النموذج الرئيسي لإدارة عقود هيئة النقل
- `sta_branch.py`: نموذج إدارة فروع هيئة النقل
- `sta_rent_policy.py`: نموذج إدارة سياسات الإيجار

**مجلد Controllers**: يحتوي على متحكمات واجهات برمجة التطبيقات:
- `sta_api_controller.py`: المتحكم الرئيسي للتعامل مع واجهات برمجة التطبيقات

**مجلد Wizards**: يحتوي على المعالجات التفاعلية:
- `sta_send_otp_wizard.py`: معالج إرسال رمز التحقق
- `sta_cancel_contract_wizard.py`: معالج إلغاء العقد
- `sta_suspend_contract_wizard.py`: معالج تعليق العقد
- `sta_close_contract_wizard.py`: معالج إغلاق العقد

**مجلد Views**: يحتوي على ملفات واجهة المستخدم بصيغة XML
**مجلد Security**: يحتوي على إعدادات الأمان وحقوق الوصول
**مجلد Data**: يحتوي على البيانات الأولية للموديول

### واجهات برمجة التطبيقات المستخدمة

يتكامل الموديول مع عدة واجهات برمجة تطبيقات مختلفة من هيئة النقل السعودية:

**واجهة إنشاء العقود**: `POST /rental-api/rent-contract/create`
تستخدم لإنشاء عقد جديد في أنظمة هيئة النقل. تتطلب البيانات الأساسية للعقد مثل رقم العقد، معرف المشغل، ومعرف الفرع.

**واجهة إرسال رمز التحقق**: `GET /rental-api/rent-contract/{contractNumber}/send-otp`
تستخدم لطلب إرسال رمز التحقق للعميل. تتطلب رقم العقد كمعامل في المسار.

**واجهة حفظ العقد**: `POST /rental-api/rent-contract`
تستخدم لحفظ جميع تفاصيل العقد بعد التحقق. تتطلب بيانات شاملة عن العقد، العميل، المركبة، والدفع.

**واجهة إلغاء العقد**: `PUT /rental-api/rent-contract/{contractNumber}/cancel`
تستخدم لإلغاء عقد موجود مع تحديد سبب الإلغاء.

**واجهة تعليق العقد**: `PUT /rental-api/rent-contract/suspension`
تستخدم لتعليق عقد مع تفاصيل حالة المركبة والدفع.

**واجهة إغلاق العقد**: `PUT /rental-api/rent-contract/closure`
تستخدم لإغلاق عقد نهائياً مع تفاصيل الإنهاء.

**واجهة الحصول على الفروع**: `GET /rental-api/branch/all`
تستخدم لتحميل قائمة جميع الفروع المعتمدة من هيئة النقل.

**واجهة الحصول على سياسات الإيجار**: `GET /rental-api/rent-policy/all`
تستخدم لتحميل قائمة جميع سياسات الإيجار المتاحة.

### آلية المصادقة والأمان

يستخدم الموديول نظام مصادقة متعدد الطبقات لضمان الأمان:

**مصادقة التطبيق**: كل طلب يتضمن معرف التطبيق (App ID) ومفتاح التطبيق (App Key) في رؤوس HTTP.

**مصادقة المستخدم**: يتم استخدام رمز التفويض (Authorization Token) المشفر بنظام Basic Authentication.

**تشفير البيانات**: جميع الاتصالات تتم عبر بروتوكول HTTPS مع تشفير SSL/TLS.

**تسجيل العمليات**: يتم تسجيل جميع العمليات والاستجابات لأغراض المراجعة والتدقيق.

### إدارة الأخطاء والاستثناءات

يتضمن الموديول نظام شامل لإدارة الأخطاء:

**التعامل مع أخطاء الشبكة**: يتم التعامل مع انقطاع الاتصال، انتهاء المهلة الزمنية، وأخطاء الخادم بطريقة مناسبة.

**التعامل مع أخطاء البيانات**: يتم التحقق من صحة البيانات قبل الإرسال ومعالجة أخطاء التحقق.

**تسجيل الأخطاء**: جميع الأخطاء يتم تسجيلها مع تفاصيل كاملة لتسهيل عملية استكشاف الأخطاء.

**الاسترداد التلقائي**: في بعض الحالات، يحاول النظام إعادة المحاولة تلقائياً عند فشل العملية.

### قاعدة البيانات والنماذج

**نموذج STA Contract**: يحتوي على جميع معلومات عقود هيئة النقل، بما في ذلك رقم العقد، الحالة، وسجلات التزامن.

**نموذج STA Branch**: يخزن معلومات فروع هيئة النقل مع ربطها بفروع الشركة في أودو.

**نموذج STA Rent Policy**: يحتوي على سياسات الإيجار المختلفة مع شروطها وأحكامها.

**العلاقات بين النماذج**: تم تصميم علاقات واضحة بين النماذج لضمان تكامل البيانات.

### الأداء والتحسين

**التخزين المؤقت**: يتم استخدام التخزين المؤقت لتقليل عدد الطلبات إلى خوادم هيئة النقل.

**المعالجة غير المتزامنة**: العمليات الطويلة يتم تنفيذها في الخلفية لتجنب تعليق واجهة المستخدم.

**ضغط البيانات**: يتم ضغط البيانات المرسلة لتقليل استهلاك النطاق الترددي.

**مراقبة الأداء**: يتم مراقبة أداء العمليات وتسجيل الإحصائيات لأغراض التحسين.

---

## استكشاف الأخطاء وإصلاحها

### المشاكل الشائعة وحلولها

**مشكلة فشل الاتصال مع هيئة النقل**:
هذه من أكثر المشاكل شيوعاً وقد تحدث لعدة أسباب. أولاً، تحقق من صحة بيانات الاعتماد المدخلة في الإعدادات. تأكد من أن App ID وApp Key وAuthorization Token مدخلة بشكل صحيح وبدون مسافات إضافية. ثانياً، تحقق من استقرار الاتصال بالإنترنت وتأكد من أن الخادم يمكنه الوصول إلى عناوين هيئة النقل. ثالثاً، تحقق من إعدادات الجدار الناري والتأكد من السماح للاتصالات الصادرة على المنفذ 443.

**مشكلة عدم ظهور الموديول في قائمة التطبيقات**:
إذا لم يظهر الموديول في قائمة التطبيقات، تأكد أولاً من أن الملفات تم نسخها إلى المجلد الصحيح. ثم تأكد من إعادة تشغيل خدمة أودو بعد نسخ الملفات. بعد ذلك، انقر على "تحديث قائمة التطبيقات" في واجهة إدارة أودو. إذا استمرت المشكلة، تحقق من سجلات النظام للبحث عن رسائل خطأ قد تشير إلى مشاكل في بنية الملفات.

**مشكلة فشل تزامن البيانات**:
عند فشل تزامن الفروع أو سياسات الإيجار، تحقق أولاً من حالة الاتصال مع هيئة النقل. إذا كان الاتصال سليماً، تحقق من صلاحيات المستخدم للوصول إلى واجهات برمجة التطبيقات المطلوبة. قد تحتاج إلى التواصل مع هيئة النقل للتأكد من تفعيل الصلاحيات المناسبة لحسابك.

**مشكلة فشل إرسال رمز التحقق (OTP)**:
إذا فشل إرسال رمز التحقق، تأكد أولاً من أن العقد تم إنشاؤه بنجاح في أنظمة هيئة النقل. تحقق من صحة رقم العقد وتأكد من أن معلومات العميل مكتملة وصحيحة. إذا استمرت المشكلة، قد تحتاج إلى التواصل مع الدعم التقني لهيئة النقل.

### رسائل الخطأ الشائعة

**"HTTP 401: Unauthorized"**:
هذا الخطأ يشير إلى مشكلة في المصادقة. تحقق من صحة رمز التفويض (Authorization Token) وتأكد من أنه لم ينته صلاحيته. قد تحتاج إلى طلب رمز جديد من هيئة النقل.

**"HTTP 400: Bad Request"**:
يشير هذا الخطأ إلى مشكلة في البيانات المرسلة. تحقق من اكتمال جميع الحقول المطلوبة وصحة تنسيق البيانات. راجع سجلات النظام للحصول على تفاصيل أكثر عن البيانات المرفوضة.

**"Connection Timeout"**:
يحدث هذا الخطأ عند انتهاء المهلة الزمنية للاتصال. تحقق من استقرار الاتصال بالإنترنت وسرعة الشبكة. قد تحتاج إلى زيادة المهلة الزمنية في إعدادات النظام.

**"SSL Certificate Error"**:
يشير إلى مشكلة في شهادات الأمان. تأكد من أن النظام يدعم أحدث بروتوكولات SSL/TLS وأن شهادات الأمان محدثة.

### أدوات التشخيص

**سجلات النظام**: تحقق من سجلات أودو في `/var/log/odoo/` للبحث عن رسائل خطأ مفصلة.

**اختبار الاتصال**: استخدم أداة اختبار الاتصال المدمجة في الإعدادات للتحقق من حالة الاتصال.

**مراجعة سجلات الاستجابة**: في كل عقد، يمكن مراجعة سجل استجابات هيئة النقل في تبويب "STA Response Log".

**أدوات الشبكة**: استخدم أدوات مثل `curl` أو `wget` لاختبار الاتصال مباشرة مع خوادم هيئة النقل.

### إجراءات الصيانة الدورية

**تحديث البيانات**: قم بتزامن الفروع وسياسات الإيجار دورياً للتأكد من تحديث البيانات.

**مراجعة السجلات**: راجع سجلات النظام بانتظام للبحث عن أي مشاكل محتملة.

**اختبار الاتصال**: اختبر الاتصال مع هيئة النقل دورياً للتأكد من استمرار عمل التكامل.

**نسخ احتياطية**: تأكد من إجراء نسخ احتياطية منتظمة لقاعدة البيانات وإعدادات النظام.

---

## الأسئلة الشائعة

**س: هل يمكن استخدام الموديول مع إصدارات أقدم من أودو؟**
ج: الموديول مصمم خصيصاً للعمل مع Odoo 18 Enterprise. لا يدعم الإصدارات الأقدم بسبب اعتماده على ميزات وواجهات برمجة تطبيقات حديثة.

**س: كم من الوقت يستغرق تزامن البيانات مع هيئة النقل؟**
ج: عادة ما يستغرق تزامن البيانات بضع ثوانٍ إلى دقائق قليلة، حسب حجم البيانات وسرعة الاتصال. العمليات الكبيرة قد تستغرق وقتاً أطول.

**س: هل يمكن تخصيص الموديول لمتطلبات خاصة؟**
ج: نعم، الموديول مصمم بطريقة مرنة تسمح بالتخصيص والتوسيع. يمكن إضافة حقول جديدة أو تعديل العمليات حسب الحاجة.

**س: ماذا يحدث إذا انقطع الاتصال أثناء إرسال عقد؟**
ج: النظام مصمم للتعامل مع انقطاع الاتصال. سيحاول إعادة الإرسال تلقائياً، وفي حالة الفشل، سيتم تسجيل الخطأ ويمكن إعادة المحاولة يدوياً.

**س: هل يمكن استخدام الموديول مع عدة شركات في نفس قاعدة البيانات؟**
ج: نعم، الموديول يدعم البيئات متعددة الشركات ويمكن تكوين إعدادات منفصلة لكل شركة.

---

## الدعم والصيانة

### الحصول على الدعم التقني

للحصول على الدعم التقني، يمكن التواصل من خلال القنوات التالية:

**الدعم الأساسي**: يشمل المساعدة في التثبيت، الإعداد الأولي، واستكشاف الأخطاء الأساسية.

**الدعم المتقدم**: يشمل التخصيص، التطوير الإضافي، والتكامل مع أنظمة أخرى.

**التدريب**: يتوفر تدريب شامل للمستخدمين والمطورين على استخدام وتطوير الموديول.

### تحديثات الموديول

**التحديثات الأمنية**: يتم إصدار تحديثات أمنية فورية عند اكتشاف أي ثغرات.

**التحديثات الوظيفية**: يتم إصدار تحديثات دورية لإضافة ميزات جديدة وتحسين الأداء.

**التوافق مع هيئة النقل**: يتم تحديث الموديول عند تغيير واجهات برمجة التطبيقات من قبل هيئة النقل.

### الضمان والصيانة

**ضمان الجودة**: يتم ضمان عمل الموديول وفقاً للمواصفات المحددة لمدة عام من تاريخ التثبيت.

**الصيانة الدورية**: تشمل مراجعة الأداء، تحديث البيانات، وإجراء الاختبارات الدورية.

**الدعم الطارئ**: يتوفر دعم طارئ على مدار الساعة للمشاكل الحرجة التي تؤثر على العمليات.

---

## الخلاصة

موديول التكامل مع هيئة النقل السعودية يمثل حلاً متكاملاً وموثوقاً لشركات تأجير السيارات في المملكة العربية السعودية. يوفر الموديول تكاملاً سلساً مع أنظمة هيئة النقل، مما يضمن الامتثال للمتطلبات التنظيمية ويحسن من كفاءة العمليات.

من خلال الميزات المتقدمة والواجهات البديهية، يمكن للمستخدمين إدارة عقود الإيجار بسهولة وثقة، مع ضمان دقة البيانات وأمان العمليات. الموديول مصمم ليكون قابلاً للتوسيع والتخصيص، مما يجعله مناسباً لشركات بأحجام وأنواع مختلفة.

نحن ملتزمون بتوفير أفضل مستوى من الدعم والصيانة لضمان استمرار عمل النظام بكفاءة عالية. مع التحديثات المستمرة والتطوير المتواصل، سيبقى الموديول متوافقاً مع أحدث متطلبات هيئة النقل السعودية ومعايير الصناعة.

---

**تم إعداد هذا الدليل بواسطة:** Manus AI  
**تاريخ آخر تحديث:** يونيو 2025  
**رقم الإصدار:** 1.0.0

